<!DOCTYPE html>
<!--
Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license

Modified by garyfeng, 2015
-->

<html>
<head>
	<meta charset="utf-8">
	<title>CKEditor Keystrokelog Plug-in Test</title>

	<!-- garyfeng: process data logging init -->
	<script src="FileSaver.min.js" type="text/javascript"></script>
	<script src="Blob.js" type="text/javascript"></script>
	<!-- this is a version of log4javascript modified by garyfeng -->
	<script src="log4javascript_uncompressed.js"  type="text/javascript"></script>
	<script src="diff.js"  type="text/javascript"></script>

	<!-- garyfeng's event logging script, hooking stuff all over the places -->
	<script src="eventlogging.js" type="text/javascript" ></script>
	<!-- End of garyfeng -->

	<!-- load ckeditor -->
	<script src="../../../ckeditor.js"></script>
	<link href="../../../samples/sample.css" rel="stylesheet">

</head>
<body>
	<h1 class="samples">
		<a href="../../../samples/index.html">CKEditor Samples</a> &raquo; the KeystrokeLog Plugin
	</h1>
	<form action="sample_posteddata.php" method="post">
		<textarea cols="80" id="editor1" name="editor1" rows="10">
			&lt;p&gt;Type some text&lt;/p&gt;
			&lt;p&gt;Select some words and change it to bold.&lt;/p&gt;
		</textarea>
		<p>
			<input type="submit" value="Submit">
		</p>
	</form>

	<div id="divHTML2Text" style={display:hidden}></div>

	<div id="footer">
		<hr>
		<p>
			CKEditor - The text editor for the Internet - <a class="samples" href="http://ckeditor.com/">http://ckeditor.com</a>
		</p>
		<p id="copy">
			Copyright &copy; 2003-2015, <a class="samples" href="http://cksource.com/">CKSource</a> - Frederico
			Knabben. All rights reserved.
		</p>
	</div>
	<div id="debugConsole">
		<div>Snapshots: <strong id="debugSnapshotsCount">0</strong></div>
		<div>Typing: <strong id="debugTypingVal">false</strong></div>
	</div>
	<div id="undoControls">
		<a onclick="CKEDITOR.instances.editor1.execCommand('undo');" href="#">&lt; Undo</a>
		<a onclick="CKEDITOR.instances.editor1.execCommand('redo');" href="#">Redo &gt;</a>
	</div>
	<div class="description">
		<p>
			This editor is using an <code>&lt;iframe&gt;</code>
			element-based editing area, provided by the <strong>Wysiwygarea</strong> plugin.
		</p><br/>
		<pre class="samples">
		CKEDITOR.replace( '<em>textarea_id</em>' )
		</pre>
		<p>
			To view keystroke logging, turn on the "javascrip inspector" in your browser. You
			should see debugging messages. The logger uses log4javascript, with only the
			consoleAppender turned on. You can use a stringAppender to cache the log entries
			in the memory, or use ajaxAppender to post the log to a remote server.
		</p>

	</div>
	<script type="text/javascript">
	var snapCount = document.getElementById( 'debugSnapshotsCount' ),
		typingTracer = document.getElementById( 'debugTypingVal' ),
		updateTypingTracer = function() {
			typingTracer.innerHTML = String( CKEDITOR.instances.editor1.keystrokeManager.typing );
		},
		updateSnapshotCounter = function() {
			if ( !CKEDITOR && CKEDITOR.instances.editor1 )
				return;

			if (typeof CKEDITOR.instances.editor1.keystrokeManager == "undefined")
				return;

			snapCount.innerHTML = CKEDITOR.instances.editor1.keystrokeManager.snapshots.length;
			updateTypingTracer();
		};

	CKEDITOR.replace( 'editor1', {
		toolbar: [ [ 'Source', 'Bold', 'Italic' ] , ['Copy', 'Paste'], [ 'Undo' ], [ 'Redo' ] ],
		on: {
			instanceReady: function( evt ) {
				//console.log("--> editor is ready")
				CKEDITOR.instances.editor1.focus();
			},
			change: function( evt ) {
				//console.log("--> change:");
				//console.log(evt);
				updateSnapshotCounter();
			}
		}
	} );

	window.setInterval( updateSnapshotCounter, 700 );
	</script>
	<style type="text/css">
	#debugConsole { clear: both; }
	#undoControls { clear: both; }
	#undoControls a { padding: 25px 50px; font-size: 19px; margin-right: 15px; outline: 2px solid gray; display: block; float: left; text-decoration: none; }
	</style>
</body>
</html>
